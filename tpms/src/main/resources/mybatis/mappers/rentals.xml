<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.lce.tpms.dao.RentalDao">

	<resultMap type="com.lce.tpms.vo.Rental" id="RentalMap">
		<id column="retal_code"  property="code"/>
		<result column="user_code" property="userCode"/>
		<result column="phone_code" property="phoneCode"/>
		<result column="rental_start_date" property="startDate"/>
		<result column="rental_end_date" property="endDate"/>
		<result column="rental_give_date" property="giveDate"/>
		<result column="rental_status" property="status"/>
	</resultMap>
	
	<insert id="insertRental" parameterType="com.lce.tpms.vo.Rental">
	insert into rental
		(rental_code, user_code, phone_code, rental_start_date, rental_end_date)
	values
		('RT' || lpad(RENTAL_SEQ.nextval, 4, 0), #{userCode}, #{phoneCode}, #{startDate}, #{endDate})
	</insert>
	
	<select id="getCurrentRentalList" resultMap="RentalMap">
		select
			*
		from 
			rental
		where
			rental_give not in ('ING')
	</select>
	
	<select id="getFinRentalsByUser" parameterType="string" resultType="map">
		select
	        rental.rental_code 			as code,
	        rental.user_code 			as userCode,
	        phone.phone_code 			as phoneCode,
	        rental.rental_start_date 	as startDate,
	        rental.rental_end_date 		as endDate,
	        rental.rental_give_date 	as giveDate,
	        phone.phone_name 			as name,
	        phone.phone_maker 			as maker,
	        phone.phone_os 				as os,
	        phone.phone_version 		as version
		from
			rental, phone
		where
			user_code = #{userCode}
        and 
        	rental.phone_code = phone.phone_code
        and 
        	rental.rental_status = 'FIN'
        order by 
        	rental.rental_end_date desc
	</select>
	
	<select id="getRentalByUserAndStatus" parameterType="map" resultType="map">
		select
		        rental.rental_code 			as code,
		        rental.user_code 			as userCode,
		        phone.phone_code 			as phoneCode,
		        rental.rental_start_date 	as startDate,
		        rental.rental_end_date 		as endDate,
		        phone.phone_name 			as name,
		        phone.phone_maker 			as maker,
		        phone.phone_os 				as os,
		        phone.phone_version 		as version,
		        rental.rental_status 		as status
			from
				rental, phone
			where
				user_code = #{userCode}
	        and 
	        	rental.phone_code = phone.phone_code
	        and 
	        	rental.rental_status = #{status}
	</select>
	
	<select id="getWaitRentals" resultType="map">
		select 
		    rental.rental_code 			as code,
		    users.user_code 			as userCode,
		    phone.phone_code 			as phoneCode,
		    rental.rental_start_date 	as startDate,
		    rental.rental_end_date 		as endDate,
		    users.user_name 			as userName,
		    users.user_team 			as userTeam,
		    users.user_position 		as userPosition,
		    phone.phone_name  			as phoneName,
		    phone.phone_maker  			as phoneMaker,
		    phone.phone_os 				as phoneOS,
		    phone.phone_version 		as phoneVersion
		from 
			rental, users, phone
		where 
			rental.rental_status = 'WAIT'
		and 
			rental.user_code = users.user_code
		and 
			rental.phone_code = phone.phone_code
	</select>

	<select id="getRentalByCode" parameterType="string" resultMap="RentalMap">
		select
			*
		from
			rental
		where
			rental_code = #{value}
	</select>
	
	<select id="getRentalByUserCode" parameterType="string" resultMap="RentalMap">
		select
			*
		from
			rental
		where
			rental_code = #{value}
	</select>
	
	<select id="getRentalsByPhoneCode" parameterType="string" resultMap="RentalMap">
		select
			*
		from 
			rental
		where
			phone_code = #{value}
	</select>
</mapper>