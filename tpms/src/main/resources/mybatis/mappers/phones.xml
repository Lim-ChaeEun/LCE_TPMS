<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.lce.tpms.dao.PhoneDao">

	<resultMap type="com.lce.tpms.vo.Phone" id="PhoneMap">
		<id column="phone_code"  property="code"/>
		<result column="phone_name"  property="modelName"/>
		<result column="phone_maker"  property="maker"/>
		<result column="phone_os"  property="os"/>
		<result column="phone_version"  property="version"/>
		<result column="phone_mac_address"  property="macAddress"/>
		<result column="phone_password"  property="password"/>
		<result column="phone_memory"  property="memory"/>
		<result column="phone_display"  property="display"/>
	</resultMap>
	
	<insert id="insertPhone" parameterType="com.lce.tpms.vo.Phone">
		insert into phones
    		(PHONE_CODE, PHONE_NAME, PHONE_MAKER, PHONE_OS, PHONE_VERSION, PHONE_MAC_ADDRESS, PHONE_PASSWORD, PHONE_MEMORY, PHONE_DISPLAY)
		values
    		('PHONE' || lpad(PHONE_SEQ.nextval, 3, 0), #{modelName}, #{maker}, #{os}, #{version}, #{macAddress}, #{password}, #{memory}, #{display})
	</insert>
	
	<select id="getAllPhonesContainsRental" resultType="map">
		select 
		    phones.phone_code				AS 	code,
		    phones.phone_name 			AS 	name, 
		    phones.phone_maker 			AS 	maker, 
		    phones.phone_os					AS 	os, 
		    phones.phone_version 		AS 	version, 
		    phones.phone_memory 		AS 	memory,
		    phones.phone_display 			AS 	display, 
		    rentals.rental_end_date 		AS 	enddate, 
		    rentals.rental_status 			AS	status
		from 
			phones, RENTALS
		where
	    	rentals.PHONE_CODE(+) = phones.PHONE_CODE
	   	and
            (rentals.rental_status in ('WAIT', 'ING') OR rentals.rental_status IS NULL)
	</select>
	
	
	<select id="getAllPhones" resultMap="PhoneMap">
		select
			*
		from 
			phones
	</select>
	
</mapper>